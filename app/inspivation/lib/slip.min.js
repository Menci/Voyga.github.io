/*!
    Slip.js 1.2.0

    © 2014 Kornel Lesiński <kornel@geekhood.net>. All rights reserved.

    Redistribution and use in source and binary forms, with or without modification,
    are permitted provided that the following conditions are met:

    1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.

    2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
       the following disclaimer in the documentation and/or other materials provided with the distribution.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
    DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
    SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
    WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
    USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
;window.Slip=(function(){var n=/Chrome\/[34]/.test(navigator.userAgent);var a=n;var l=n;var g=document.createElement("div");var q="webkitTransition" in g.style?"webkitTransition":"transition";var e="webkitTransform" in g.style?"webkitTransform":"transform";var j=e==="webkitTransform"?"-webkit-transform":"transform";var d="webkitUserSelect" in g.style?"webkitUserSelect":"userSelect";g.style[e]="translateZ(0)";var s=g.style[e]?"translateZ(0) ":"";var t=g.style[e]?"translateZ(1px) ":"";g=null;var k=0;var f=false;var i=function(){};function h(u,v){if("string"===typeof u){u=document.querySelector(u)}if(!u||!u.addEventListener){throw new Error("Please specify DOM node to attach to")}if(!this||this===window){return new h(u,v)}this.options=v;this.cancel=this.setState.bind(this,this.states.idle);this.onTouchStart=this.onTouchStart.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.onMouseDown=this.onMouseDown.bind(this);this.onMouseMove=this.onMouseMove.bind(this);this.onMouseUp=this.onMouseUp.bind(this);this.onMouseLeave=this.onMouseLeave.bind(this);this.onSelection=this.onSelection.bind(this);this.setState(this.states.idle);this.attach(u)}function p(w){var u=w.style[e];if(u){return{value:u,original:u}}if(window.getComputedStyle){var v=window.getComputedStyle(w).getPropertyValue(j);if(v&&v!=="none"){return{value:v,original:""}}}return{value:"",original:""}}function c(y,v){var x=0;var u=0;for(var w=0;w<v.length;w++){if(v[w].nodeType===1){u++;if(v[w]===y.node){x=u-1}}}return x}h.prototype={container:null,options:{},state:null,target:null,usingTouch:false,mouseHandlersAttached:false,startPosition:null,latestPosition:null,previousPosition:null,canPreventScrolling:false,states:{idle:function m(){this.target=null;this.usingTouch=false;this.removeMouseHandlers();return{allowTextSelection:true}},undecided:function b(){this.target.height=this.target.node.offsetHeight;this.target.node.style[q]="";if(!this.dispatch(this.target.originalTarget,"beforewait")){if(this.dispatch(this.target.originalTarget,"beforereorder")){this.setState(this.states.reorder)}}else{var u=setTimeout(function(){var v=this.getAbsoluteMovement();if(this.canPreventScrolling&&v.x<15&&v.y<25){if(this.dispatch(this.target.originalTarget,"beforereorder")){this.setState(this.states.reorder)}}}.bind(this),300)}return{leaveState:function(){clearTimeout(u)},onMove:function(){var v=this.getAbsoluteMovement();if(v.x>20&&v.y<Math.max(100,this.target.height)){if(this.dispatch(this.target.originalTarget,"beforeswipe")){this.setState(this.states.swipe);return false}else{this.setState(this.states.idle)}}if(v.y>20){this.setState(this.states.idle)}if(v.x>v.y*1.2){return false}},onLeave:function(){this.setState(this.states.idle)},onEnd:function(){var v=this.dispatch(this.target.originalTarget,"tap");this.setState(this.states.idle);return v}}},swipe:function r(){var u=false;var v=this.container;var w=c(this.target,this.container.childNodes);v.className+=" slip-swiping-container";function x(){v.className=v.className.replace(/(?:^| )slip-swiping-container/,"")}this.target.height=this.target.node.offsetHeight;return{leaveState:function(){if(u){this.animateSwipe(function(y){y.node.style[e]=y.baseTransform.original;y.node.style[q]="";if(this.dispatch(y.node,"afterswipe")){x();return true}else{this.animateToZero(undefined,y)}}.bind(this))}else{this.animateToZero(x);this.dispatch(this.target.node,"cancelswipe")}},onMove:function(){var y=this.getTotalMovement();if(Math.abs(y.y)<this.target.height+20){this.target.node.style[e]="translate("+y.x+"px,0) "+s+this.target.baseTransform.value;return false}else{this.setState(this.states.idle)}},onLeave:function(){this.state.onEnd.call(this)},onEnd:function(){var A=this.latestPosition.x-this.previousPosition.x;var z=this.latestPosition.y-this.previousPosition.y;var C=Math.sqrt(A*A+z*z)/(this.latestPosition.time-this.previousPosition.time+1);var y=this.getAbsoluteMovement();var B=C>0.6&&y.time>110;var D;if(A>0){D="right"}else{D="left"}if(B){if(this.dispatch(this.target.node,"swipe",{direction:D,originalIndex:w})){u=true}}this.setState(this.states.idle);return !B}}},reorder:function o(){this.target.height=this.target.node.offsetHeight;var v=this.container.childNodes;var A=c(this.target,v);var y;var z=this.target.node.offsetTop+this.target.height/2;var B=[];for(var x=0;x<v.length;x++){if(v[x].nodeType!=1||v[x]===this.target.node){continue}var w=v[x].offsetTop;v[x].style[q]=j+" 0.2s ease-in-out";B.push({node:v[x],baseTransform:p(v[x]),pos:w+(w<z?v[x].offsetHeight:0)-z})}this.target.node.className+=" slip-reordering";this.target.node.style.zIndex="99999";this.target.node.style[d]="none";if(l){this.container.style.webkitTransformStyle="preserve-3d"}function u(){if(y){clearTimeout(y);y=null}var D=this.getTotalMovement();this.target.node.style[e]="translate(0,"+D.y+"px) "+t+this.target.baseTransform.value;var C=this.target.height;B.forEach(function(F){var E=0;if(F.pos<0&&D.y<0&&F.pos>D.y){E=C}else{if(F.pos>0&&D.y>0&&F.pos<D.y){E=-C}}F.node.style[e]=E?"translate(0,"+E+"px) "+s+F.baseTransform.value:F.baseTransform.original});return false}u.call(this);return{leaveState:function(){if(y){clearTimeout(y)}if(l){this.container.style.webkitTransformStyle=""}this.target.node.className=this.target.node.className.replace(/(?:^| )slip-reordering/,"");this.target.node.style[d]="";this.animateToZero(function(C){C.node.style.zIndex=""});B.forEach(function(C){C.node.style[e]=C.baseTransform.original;C.node.style[q]=""})},onMove:u,onLeave:function(){if(y){clearTimeout(y)}y=setTimeout(function(){y=null;this.cancel()}.bind(this),700)},onEnd:function(){var C=this.getTotalMovement();if(C.y<0){for(var D=0;D<B.length;D++){if(B[D].pos>C.y){this.dispatch(this.target.node,"reorder",{spliceIndex:D,insertBefore:B[D].node,originalIndex:A});break}}}else{for(var D=B.length-1;D>=0;D--){if(B[D].pos<C.y){this.dispatch(this.target.node,"reorder",{spliceIndex:D+1,insertBefore:B[D+1]?B[D+1].node:null,originalIndex:A});break}}}this.setState(this.states.idle);return false}}}},attach:function(u){k++;if(this.container){this.detach()}if(!f&&a){f=true;document.body.addEventListener("touchstart",i,false)}this.container=u;this.otherNodes=[];document.addEventListener("selectionchange",this.onSelection,false);this.container.addEventListener("touchcancel",this.cancel,false);this.container.addEventListener("touchstart",this.onTouchStart,false);this.container.addEventListener("touchmove",this.onTouchMove,false);this.container.addEventListener("touchend",this.onTouchEnd,false);this.container.addEventListener("mousedown",this.onMouseDown,false)},detach:function(){this.cancel();this.container.removeEventListener("mousedown",this.onMouseDown,false);this.container.removeEventListener("touchend",this.onTouchEnd,false);this.container.removeEventListener("touchmove",this.onTouchMove,false);this.container.removeEventListener("touchstart",this.onTouchStart,false);this.container.removeEventListener("touchcancel",this.cancel,false);document.removeEventListener("selectionchange",this.onSelection,false);k--;if(!k&&f){f=false;document.body.removeEventListener("touchstart",i,false)}},setState:function(v){if(this.state){if(this.state.ctor===v){return}if(this.state.leaveState){this.state.leaveState.call(this)}}var w=this.state;var u=v.call(this);if(this.state===w){u.ctor=v;this.state=u}},findTargetNode:function(u){while(u&&u.parentNode!==this.container){u=u.parentNode}return u},onSelection:function(v){var u=v.target===document||this.findTargetNode(v);if(!u){return}if(v.cancelable||v.defaultPrevented){if(!this.state.allowTextSelection){v.preventDefault()}}else{this.setState(this.states.idle)}},addMouseHandlers:function(){if(!this.mouseHandlersAttached){this.mouseHandlersAttached=true;document.documentElement.addEventListener("mouseleave",this.onMouseLeave,false);window.addEventListener("mousemove",this.onMouseMove,true);window.addEventListener("mouseup",this.onMouseUp,true);window.addEventListener("blur",this.cancel,false)}},removeMouseHandlers:function(){if(this.mouseHandlersAttached){this.mouseHandlersAttached=false;document.documentElement.removeEventListener("mouseleave",this.onMouseLeave,false);window.removeEventListener("mousemove",this.onMouseMove,true);window.removeEventListener("mouseup",this.onMouseUp,true);window.removeEventListener("blur",this.cancel,false)}},onMouseLeave:function(u){if(this.usingTouch){return}if(u.target===document.documentElement||u.relatedTarget===document.documentElement){if(this.state.onLeave){this.state.onLeave.call(this)}}},onMouseDown:function(u){if(this.usingTouch||u.button!=0||!this.setTarget(u)){return}this.addMouseHandlers();this.canPreventScrolling=true;this.startAtPosition({x:u.clientX,y:u.clientY,time:u.timeStamp})},onTouchStart:function(u){this.usingTouch=true;this.canPreventScrolling=true;if(u.touches.length>1){this.setState(this.states.idle);return}if(!this.setTarget(u)){return}this.startAtPosition({x:u.touches[0].clientX,y:u.touches[0].clientY-window.scrollY,time:u.timeStamp})},setTarget:function(w){var v=this.findTargetNode(w.target);if(!v){this.setState(this.states.idle);return false}var u=v.parentNode;while(u){if(u.scrollHeight>u.clientHeight&&window.getComputedStyle(u)["overflow-y"]!="visible"){break}else{u=u.parentNode}}this.target={originalTarget:w.target,node:v,scrollContainer:u,baseTransform:p(v)};return true},startAtPosition:function(u){this.startPosition=this.previousPosition=this.latestPosition=u;this.setState(this.states.undecided)},updatePosition:function(y,z){this.latestPosition=z;var D=40,w=0;var A=this.target.scrollContainer||document.body,B=A.getBoundingClientRect(),u=this.target.node.getBoundingClientRect(),v=Math.min(B.bottom,window.innerHeight)-u.bottom,x=u.top-Math.max(B.top,0);if(v<D){w=D-v}else{if(x<D){w=x-D}}var C=A.scrollTop;A.scrollTop+=w;if(C!=A.scrollTop){this.startPosition.y+=C-A.scrollTop}if(this.state.onMove){if(this.state.onMove.call(this)===false){y.preventDefault()}}if(this.latestPosition.time-this.previousPosition.time>100){this.previousPosition=this.latestPosition}},onMouseMove:function(u){this.updatePosition(u,{x:u.clientX,y:u.clientY,time:u.timeStamp})},onTouchMove:function(u){this.updatePosition(u,{x:u.touches[0].clientX,y:u.touches[0].clientY-window.scrollY,time:u.timeStamp});this.canPreventScrolling=false},onMouseUp:function(u){if(this.usingTouch||u.button!==0){return}if(this.state.onEnd&&false===this.state.onEnd.call(this)){u.preventDefault()}},onTouchEnd:function(u){if(u.touches.length>1){this.cancel()}else{if(this.state.onEnd&&false===this.state.onEnd.call(this)){u.preventDefault()}}},getTotalMovement:function(){return{x:this.latestPosition.x-this.startPosition.x,y:this.latestPosition.y-this.startPosition.y}},getAbsoluteMovement:function(){return{x:Math.abs(this.latestPosition.x-this.startPosition.x),y:Math.abs(this.latestPosition.y-this.startPosition.y),time:this.latestPosition.time-this.startPosition.time}},dispatch:function(x,u,v){var w=document.createEvent("CustomEvent");if(w&&w.initCustomEvent){w.initCustomEvent("slip:"+u,true,true,v)}else{w=document.createEvent("Event");w.initEvent("slip:"+u,true,true);w.detail=v}return x.dispatchEvent(w)},getSiblings:function(v){var w=[];var u=v.node.nextSibling;while(u){if(u.nodeType==1){w.push({node:u,baseTransform:p(u)})}u=u.nextSibling}return w},animateToZero:function(v,u){u=u||this.target;u.node.style[q]=j+" 0.1s ease-out";u.node.style[e]="translate(0,0) "+s+u.baseTransform.value;setTimeout(function(){u.node.style[q]="";u.node.style[e]=u.baseTransform.original;if(v){v.call(this,u)}}.bind(this),101)},animateSwipe:function(x){var v=this.target;var w=this.getSiblings(v);var u="translate(0,"+this.target.height+"px) "+s+" ";v.node.style[q]="all 0.1s linear";v.node.style[e]=" translate("+(this.getTotalMovement().x>0?"":"-")+"100%,0) "+s+v.baseTransform.value;setTimeout(function(){if(x.call(this,v)){w.forEach(function(y){y.node.style[q]="";y.node.style[e]=u+y.baseTransform.value});setTimeout(function(){w.forEach(function(y){y.node.style[q]=j+" 0.1s ease-in-out";y.node.style[e]="translate(0,0) "+s+y.baseTransform.value});setTimeout(function(){w.forEach(function(y){y.node.style[q]="";y.node.style[e]=y.baseTransform.original})},101)},1)}}.bind(this),101)}};if("function"===typeof define&&define.amd){define(function(){return h})}return h})();